<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Office Locations Map</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
    }
    #map {
      width: 100%;
      height: 100%;
    }
    .gm-style-iw {
      font-size: 14px;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    async function initMap() {
      try {
        const response = await fetch("https://nitiponit69.github.io/Locationoffice/data.json");
        if (!response.ok) throw new Error("โหลด data.json ไม่ได้");
        
        const locations = await response.json();

        if (locations.length === 0) {
          alert("ไม่มีข้อมูลใน data.json");
          return;
        }

        // ✅ ใช้ lat/lng (ไม่ใช่ Latitude/Longitude)
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 6,
          center: { lat: locations[0].lat, lng: locations[0].lng }
        });

        const bounds = new google.maps.LatLngBounds();

        locations.forEach(loc => {
          const marker = new google.maps.Marker({
            position: { lat: loc.lat, lng: loc.lng },
            map,
            title: loc.name
          });

          const info = new google.maps.InfoWindow({
            content: `<b>${loc.name}</b><br>ข้อมูลเพิ่มเติม: ${loc.info || "-"}<br>ผู้รับผิดชอบ: ${loc.admin || "-"}`
          });

          marker.addListener("click", () => {
            info.open(map, marker);
          });

          bounds.extend(marker.position);
        });

        // ปรับ map ให้พอดีกับ marker ทั้งหมด
        map.fitBounds(bounds);

      } catch (err) {
        console.error(err);
        document.body.innerHTML = "<h2 style='color:red;text-align:center;'>❌ โหลดแผนที่ไม่ได้ ตรวจสอบ data.json หรือ API Key</h2>";
      }
    }
  </script>

  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAEok84ylOVMh6c30ef4pZc-IzxBAbDz7w&callback=initMap"></script>
</body>
</html>
